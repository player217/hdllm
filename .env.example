# HD현대미포 Gauss-1 RAG System - Environment Configuration Template
# ====================================================================
# 이 파일을 .env로 복사하여 사용하세요 / Copy this file to .env to use
# 
# 섹션 구성 / Section Structure:
# 1. Core System Configuration (핵심 시스템 설정)
# 2. Dual Qdrant Routing (듀얼 벡터DB 라우팅)
# 3. Embedding Configuration (임베딩 설정)
# 4. LLM Configuration (언어 모델 설정)
# 5. API & Security (API 및 보안)
# 6. Performance Optimization (성능 최적화)
# 7. Logging & Monitoring (로깅 및 모니터링)
# 8. Namespace Compatibility (네임스페이스 호환성)
# ====================================================================

# ============================================================
# 1. CORE SYSTEM CONFIGURATION (핵심 시스템 설정)
# ============================================================

# Python Encoding (Windows 한글 처리)
PYTHONIOENCODING=utf-8

# Environment Mode (개발/테스트/운영)
# Options: dev | test | prod
ENV_MODE=dev

# System Paths (시스템 경로)
# 상대 경로 또는 절대 경로 사용 가능
DATA_PATH=./data
STORAGE_PATH=./storage
LOG_PATH=./logs
TEMP_PATH=./temp

# ============================================================
# 2. DUAL QDRANT ROUTING CONFIGURATION (듀얼 벡터DB 라우팅)
# ============================================================

# Personal (Local) Qdrant Instance - 개인 로컬 Qdrant
# 개인 PC에서 실행되는 Qdrant 인스턴스
QDRANT_PERSONAL_HOST=127.0.0.1
QDRANT_PERSONAL_PORT=6333
QDRANT_PERSONAL_TIMEOUT=15  # seconds
QDRANT_PERSONAL_GRPC_PORT=6334  # gRPC port for better performance

# Department Qdrant Instance - 부서 공용 Qdrant
# 부서 서버에서 실행되는 공유 Qdrant 인스턴스
QDRANT_DEPT_HOST=10.150.104.37
QDRANT_DEPT_PORT=6333
QDRANT_DEPT_TIMEOUT=20  # seconds (더 긴 타임아웃)
QDRANT_DEPT_GRPC_PORT=6334

# Routing Configuration (라우팅 설정)
# Default database scope (기본 데이터베이스 범위)
# Options: personal | dept
DEFAULT_DB_SCOPE=personal

# Fallback behavior when dept is unavailable (부서 DB 불가시 폴백)
# Options: personal | none
QDRANT_DEPT_FALLBACK=personal
QDRANT_FALLBACK_NOTIFY=true  # 폴백 발생시 사용자 알림

# Namespace Pattern Configuration (네임스페이스 패턴)
# Available variables: {scope}, {env}, {source}
# Example result: personal_dev_mail_my_documents
NAMESPACE_PATTERN={scope}_{env}_{source}_my_documents

# Namespace values for pattern
QDRANT_NAMESPACE=test  # Project namespace
QDRANT_ENV=dev        # Environment namespace

# Connection Pool Settings (연결 풀 설정)
QDRANT_MAX_CONNECTIONS=10
QDRANT_CONNECTION_TIMEOUT=5  # seconds
QDRANT_RETRY_ATTEMPTS=3
QDRANT_RETRY_DELAY=1  # seconds

# Legacy URLs (하위 호환성)
# 기존 코드와의 호환성을 위해 유지
MAIL_QDRANT_URL=http://127.0.0.1:6333
DOC_QDRANT_URL=http://127.0.0.1:6333

# ============================================================
# 3. EMBEDDING CONFIGURATION (임베딩 설정)
# ============================================================

# Embedding Backend Selection (임베딩 백엔드 선택)
# Options: st (sentence_transformers) | ollama | openai
EMBED_BACKEND=st

# Embedding Model Configuration (임베딩 모델 설정)
# For st backend: local model path or HuggingFace model ID
# For ollama backend: model name (e.g., nomic-embed-text)
EMBED_MODEL=./src/bin/bge-m3-local
# Alternative: EMBED_MODEL=BAAI/bge-m3

# Device Configuration (디바이스 설정)
# Options: cpu | cuda | cuda:0 | mps (Mac M1/M2)
EMBED_DEVICE=cpu

# Embedding Parameters (임베딩 파라미터)
EMBED_DIMENSION=1024      # BGE-M3 dimension
EMBED_BATCH_SIZE=32       # Batch size for encoding
EMBED_MAX_LENGTH=512      # Maximum text length
NORMALIZE_EMBEDDINGS=true # L2 normalization

# Embedding Cache (임베딩 캐시)
EMBED_CACHE_ENABLED=true
EMBED_CACHE_MAX=512       # Maximum cache entries
EMBED_CACHE_TTL=3600      # Cache TTL in seconds

# ============================================================
# 4. LLM CONFIGURATION (언어 모델 설정)
# ============================================================

# Ollama Configuration (Ollama 설정)
OLLAMA_HOST=127.0.0.1
OLLAMA_PORT=11434
OLLAMA_ENDPOINT=http://127.0.0.1:11434

# Default LLM Model (기본 언어 모델)
DEFAULT_LLM_MODEL=gemma3:4b
# Alternative models: llama3.2:3b, mistral:7b, qwen2.5:7b

# LLM Parameters (언어 모델 파라미터)
LLM_TEMPERATURE=0.7
LLM_MAX_TOKENS=2048
LLM_TOP_P=0.9
LLM_TOP_K=40
LLM_REPEAT_PENALTY=1.1
LLM_SEED=42  # For reproducibility

# Streaming Configuration (스트리밍 설정)
LLM_STREAM_ENABLED=true
LLM_STREAM_CHUNK_SIZE=8192  # bytes
LLM_STREAM_TIMEOUT=60       # seconds

# ============================================================
# 5. API & SECURITY CONFIGURATION (API 및 보안 설정)
# ============================================================

# CORS Configuration (CORS 설정)
# Comma-separated list of allowed origins
ALLOWED_ORIGINS=http://localhost:8001,http://127.0.0.1:8001,http://localhost:8080,http://127.0.0.1:8080

# API Security (API 보안)
API_KEY_ENABLED=false
# API_KEY=your-secure-api-key-here  # Uncomment and set if enabled

# Rate Limiting (속도 제한)
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_PER_HOUR=1000

# Request Validation (요청 검증)
MAX_QUESTION_LENGTH=2000
MAX_CONTEXT_LENGTH=10000
ENABLE_INPUT_SANITIZATION=true

# PII Protection (개인정보 보호)
PII_MASKING_ENABLED=true
PII_PATTERNS_FILE=./config/pii_patterns.json

# ============================================================
# 6. PERFORMANCE OPTIMIZATION (성능 최적화)
# ============================================================

# Cache Configuration (캐시 설정)
CACHE_BACKEND=memory  # Options: memory | redis
REDIS_URL=redis://localhost:6379/0  # If using Redis

# Performance Tuning (성능 튜닝)
EMBED_DTYPE=float32       # Options: float32 | float16 | int8
EMBED_DEVICE_MAP=auto     # For multi-GPU setups

# Qdrant Search Optimization (Qdrant 검색 최적화)
QDRANT_HNSW_EF=128       # HNSW search parameter (higher = better recall)
QDRANT_EXACT=false       # Use approximate nearest neighbor search
QDRANT_SEARCH_LIMIT=10   # Maximum search results
QDRANT_SCORE_THRESHOLD=0.3  # Minimum similarity score

# Parallel Processing (병렬 처리)
MAX_WORKERS=4            # Thread pool size
ASYNC_WORKERS=2          # Async worker processes

# Memory Management (메모리 관리)
MAX_MEMORY_MB=4096       # Maximum memory usage
ENABLE_MEMORY_PROFILING=false

# ============================================================
# 7. LOGGING & MONITORING (로깅 및 모니터링)
# ============================================================

# Logging Configuration (로깅 설정)
LOG_LEVEL=INFO           # DEBUG | INFO | WARNING | ERROR | CRITICAL
LOG_FORMAT=json          # Options: json | text
LOG_FILE_ENABLED=true
LOG_FILE_PATH=./logs/app.log
LOG_FILE_MAX_SIZE=10485760  # 10MB
LOG_FILE_BACKUP_COUNT=5

# Security Logging (보안 로깅)
LOG_REDACT_PII=true      # PII 정보 마스킹
SECURITY_AUDIT_ENABLED=true
SECURITY_LOG_FILE=./logs/security.log

# Metrics Collection (메트릭 수집)
METRICS_ENABLED=true
METRICS_NAMESPACE=rag
METRICS_EXPORT_INTERVAL=60  # seconds
PROMETHEUS_PORT=9090     # Prometheus metrics port

# Health Check (헬스 체크)
HEALTH_CHECK_INTERVAL=30  # seconds
HEALTH_CHECK_TIMEOUT=5    # seconds

# ============================================================
# 8. NAMESPACE COMPATIBILITY MODE (네임스페이스 호환 모드)
# ============================================================

# Compatibility Mode (호환성 모드)
# Enable this to support legacy collection names
# 기존 컬렉션 이름과의 호환성을 위해 활성화
NAMESPACE_COMPAT_ENABLED=true

# Legacy Collection Names (레거시 컬렉션 이름)
# Comma-separated list of fallback collection names to check
# 체크할 폴백 컬렉션 이름 목록 (쉼표로 구분)
NAMESPACE_COMPAT_FALLBACK=mail_my_documents,doc_my_documents,my_documents

# Migration Settings (마이그레이션 설정)
# Automatically migrate data from legacy to new namespace
AUTO_MIGRATE_COLLECTIONS=false
MIGRATION_BATCH_SIZE=100

# ============================================================
# 9. DEVELOPMENT & DEBUG SETTINGS (개발 및 디버그 설정)
# ============================================================

# Debug Mode (디버그 모드)
DEBUG=false
DEBUG_SQL=false
DEBUG_EMBEDDINGS=false
DEBUG_LLM=false

# Development Server (개발 서버)
DEV_SERVER_HOST=0.0.0.0
DEV_SERVER_PORT=8080
DEV_SERVER_RELOAD=true
DEV_SERVER_WORKERS=1

# Testing Configuration (테스트 설정)
TEST_MODE=false
TEST_QDRANT_HOST=127.0.0.1
TEST_QDRANT_PORT=6333
TEST_OLLAMA_HOST=127.0.0.1
TEST_OLLAMA_PORT=11434

# ============================================================
# 10. OFFLINE & PORTABLE DEPLOYMENT (오프라인 및 포터블 배포)
# ============================================================

# Portable Binary Paths (포터블 바이너리 경로)
# Leave empty to use system-installed versions
# 시스템 설치 버전을 사용하려면 비워두세요
PORTABLE_PYTHON_PATH=./bin/python311/python.exe
PORTABLE_QDRANT_PATH=./bin/qdrant/qdrant.exe
PORTABLE_OLLAMA_PATH=./bin/ollama/ollama.exe

# Offline Mode (오프라인 모드)
OFFLINE_MODE=false
LOCAL_MODEL_PATH=./models
LOCAL_CACHE_PATH=./cache

# Storage Paths for Portable Mode (포터블 모드 저장 경로)
QDRANT_STORAGE_PATH=./storage/qdrant
OLLAMA_MODEL_PATH=./storage/ollama/models

# ============================================================
# END OF CONFIGURATION
# ============================================================
# 
# 사용 방법 / Usage:
# 1. 이 파일을 .env로 복사 / Copy this file to .env
# 2. 필요한 값 수정 / Modify values as needed
# 3. 애플리케이션 재시작 / Restart application
#
# 보안 주의사항 / Security Notes:
# - .env 파일을 Git에 커밋하지 마세요 / Never commit .env to Git
# - API 키와 비밀번호는 안전하게 관리하세요 / Keep API keys secure
# - 운영 환경에서는 DEBUG=false 설정 / Set DEBUG=false in production
#
# 지원 / Support:
# HD현대미포 선각기술부 / HD Hyundai Mipo Advanced Technology Dept.
# ============================================================